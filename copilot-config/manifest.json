{
  "version": "1.0",
  "actions": [
    {
      "id": "diagnose-crop",
      "name": "Diagnose Crop",
      "description": "Analyze a crop image and provide organic treatment recommendations",
      "actionType": "HttpRequest",
      "method": "POST",
      "url": "${AGRIVOICE_API_URL}/api/v1/diagnose",
      "headers": {
        "Content-Type": "application/json"
      },
      "requestBody": {
        "image_tags": "${imageAnalysis.tags}",
        "user_question": "${userQuestion}",
        "crop_type": "${cropType}",
        "region": "${region}",
        "farmer_id": "${farmerId}"
      },
      "successResponse": {
        "resultVariable": "diagnosis",
        "mapping": {
          "disease_name": "diagnosis.disease_name",
          "severity": "diagnosis.severity",
          "solutions": "diagnosis.organic_solutions",
          "recovery_days": "diagnosis.estimated_recovery_days"
        }
      },
      "errorHandling": {
        "onError": "Show error message to user"
      }
    },
    {
      "id": "analyze-image",
      "name": "Analyze Image",
      "description": "Extract features and tags from a crop image using Azure Computer Vision",
      "actionType": "HttpRequest",
      "method": "POST",
      "url": "${AGRIVOICE_API_URL}/api/v1/analyze-image",
      "requestBody": {
        "file": "${imageFile}"
      },
      "successResponse": {
        "resultVariable": "imageAnalysis",
        "mapping": {
          "tags": "imageAnalysis.tags",
          "objects": "imageAnalysis.objects",
          "description": "imageAnalysis.description"
        }
      }
    },
    {
      "id": "speech-to-text",
      "name": "Speech to Text",
      "description": "Convert farmer's voice question to text",
      "actionType": "HttpRequest",
      "method": "POST",
      "url": "${AGRIVOICE_API_URL}/api/v1/speech-to-text",
      "requestBody": {
        "file": "${audioBlob}"
      },
      "successResponse": {
        "resultVariable": "transcription",
        "mapping": {
          "text": "transcription.text"
        }
      }
    },
    {
      "id": "text-to-speech",
      "name": "Text to Speech",
      "description": "Convert diagnosis recommendations to speech",
      "actionType": "HttpRequest",
      "method": "POST",
      "url": "${AGRIVOICE_API_URL}/api/v1/text-to-speech",
      "requestBody": {
        "text": "${diagnosisText}"
      },
      "successResponse": {
        "resultVariable": "audioResponse"
      }
    }
  ],
  "triggers": [
    {
      "id": "crop-health-check",
      "name": "Check Crop Health",
      "description": "User wants to diagnose their crop",
      "topics": ["crop_diagnosis", "disease_identification"],
      "actions": ["analyze-image", "diagnose-crop"]
    },
    {
      "id": "voice-question",
      "name": "Voice Question",
      "description": "Farmer asks a question using voice",
      "actions": ["speech-to-text", "diagnose-crop"]
    }
  ],
  "variables": {
    "AGRIVOICE_API_URL": "https://api.agrivoice.com",
    "cropType": "string",
    "region": "string",
    "farmerId": "string",
    "imageFile": "file",
    "audioBlob": "file",
    "userQuestion": "string",
    "diagnosisText": "string"
  }
}
